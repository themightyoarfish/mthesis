\usepackage{ifthen}
\newboolean{printout}
\setboolean{printout}{false}

\ifthenelse{\boolean{printout}}
{
   \PassOptionsToPackage{draft=true}{hyperref}
}{
   \PassOptionsToPackage{draft=false}{hyperref}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Custom adjustments %%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{float}
\usepackage{subcaption}
\usepackage{tabularx}
\usepackage{enumitem}
\usepackage{wrapfig}
\usepackage{caption}
\usepackage{placeins}
\usepackage{tablefootnote}
\usepackage{microtype}
\usepackage{subcaption}
\usepackage[dvipsnames,table,cymk]{xcolor}
\usepackage{multirow}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{pdfpages}

%% Pgfplots stuffs %%
\usepackage{pgfplots}
\pgfplotscreateplotcyclelist{color list}{%
   mark=*,black          \\%
   mark=*,RoyalBlue           \\%
   mark=*,webgreen         \\%
   mark=*,webbrown\\%
   mark=*,orange         \\%
   mark=*,blue           \\%
   mark=*,brown          \\%
   mark=*,cyan           \\%
   mark=*,green!70!black \\%
   mark=*,magenta        \\%
   mark=*,gray           \\%
}
\pgfplotscreateplotcyclelist{mylist}{
   mark=*,black        \\%
   mark=*,RoyalBlue          \\%
   mark=*,webgreen         \\%
   mark options=solid,mark=o,black,densely dashed\\%
   mark options=solid,mark=o,RoyalBlue,densely dashed\\%
   mark options=solid,mark=o,webgreen,densely dashed\\%
}
\pgfplotsset{
   grid style={dotted,gray},
   every axis/.append style={grid=both},
   every axis plot/.append style=
   {
      line width=1.2pt,
      mark options=solid,
   },
   cycle list name=color list,
   legend style={
      legend pos=south west,
      font=\tiny,
      legend style={row sep=-4pt},
      fill=white,
      fill opacity=0.6,
      draw opacity=1,
      text opacity=1,
   }
}

\usepackage[export]{adjustbox} % for max width in includegraphics

% Enable short captions in list of figures.
\usepackage{caption}
\usepackage{xparse}
\makeatletter
\let\latex@@caption\caption

\newif\ifallcaptionsshort% toggle switch
\allcaptionsshorttrue% Use the short ones

\RenewDocumentCommand{\caption}{+o+m}{%
  \def\@figcaptype{figure}
  \ifx\@captype\@figcaptype
  \ifallcaptionsshort
  \IfValueTF{#1}{%
    \latex@@caption[#1]{#2}%
  }{%
    \latex@@caption[#2]{#2}% No [#1] given, use the long caption then!
  }
  \else
  \latex@@caption[#2]{#2}%
  \fi
  \else
  \IfValueTF{#1}{%
    \latex@@caption[#1]{#2}%
  }{%
    \latex@@caption[#2]{#2}% No [#1] given, use the long caption then!
  }
  \fi
}
\makeatother

\usepgfplotslibrary{groupplots}
% compile plots to external file and then include -> faster compilation
\usepgfplotslibrary{external}
\tikzexternalize[prefix=gfx/autogen/,optimize command away=\includepdf]
\usepackage{pgfplotstable}
%% End Pgfplots stuffs %%

%% Other stuffs
\usepackage{graphicx}
\usepackage{IEEEtrantools}
\usepackage{tabularx}
\usepackage{mathtools}
\usepackage{stackengine}\stackMath % to use \stackgap for \underbrace spacing
\usepackage[
   german, % for correct hyphenation in german abstract
   english, % standard language
   american, % in order for the autorefnames to work (see below, could be changed)
]{babel}
\usepackage{setspace} % for adjustment of line spacing
\usepackage[lined,boxed,linesnumbered]{algorithm2e}

% \expandafter\def\csname ver@subfig.sty\endcsname{} % for subcaption or
% something
\bibliographystyle{apa}

\newcommand{\mbf}[1]{\mathbf{#1}} % shortcut for vector notation

\newcommand{\bflabel}{\aclabelfont} % without this, compile error

\usepackage{chngcntr} % defines \counterwithin
\counterwithin{figure}{chapter} % number figures as chaptno.figno
\counterwithin{equation}{chapter} % number equations as chaptno.eqno

\SetAlCapSkip{1ex} % algorithm2e distance between caption an algorithm
\newcommand{\sub}[2]{#1_{\text{#2}}}
\let\originaleqref\ref
\makeatletter
\renewcommand{\eqref}[1]{%
   \begingroup%
   \let\ref\@refstar%
   \hyperref[#1]{%
      equation%
      ~\originaleqref{#1}%
   }%
   \endgroup
}
\makeatother
\DeclareMathOperator{\atan2}{atan2}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% End Custom adjustments %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% ****************************************************************************************************
% 1. Configure classicthesis for your needs here, e.g., remove "drafting" below
% in order to deactivate the time-stamp on the pages
% ****************************************************************************************************
\PassOptionsToPackage{
   eulerchapternumbers,
   listings,
   pdfspacing,
   floatperchapter,
   %linedheaders,
   beramono,
   eulermath,
   parts,
   dottedtoc
}{classicthesis}
% ********************************************************************
% Available options for classicthesis.sty
% (see ClassicThesis.pdf for more information):
% drafting
% parts nochapters linedheaders
% eulerchapternumbers beramono eulermath pdfspacing minionprospacing
% tocaligned dottedtoc manychapters
% listings floatperchapter subfig
% ********************************************************************


% ********************************************************************
% Triggers for this config
% ********************************************************************
\usepackage{ifthen}
\newboolean{enable-backrefs} % enable backrefs in the bibliography
\setboolean{enable-backrefs}{true} % true false
% ****************************************************************************************************

% Custom colour definitions
\definecolor{verylightblue}{RGB}{243, 243, 250}
\definecolor{verydarkblue}{RGB}{37, 65, 103}
\definecolor{bluegray}{HTML}{707788}
\definecolor{winered}{HTML}{995F6C}
\definecolor{reddish}{RGB}{238, 86, 121}
\definecolor{reddish1}{HTML}{C55692}
\definecolor{reddish2}{HTML}{605A90}
\definecolor{yellowish}{RGB}{217, 216, 116}
\definecolor{mediumlightblue}{RGB}{157, 176, 191}


% ****************************************************************************************************
% 2. Personal data and user ad-hoc commands
% ****************************************************************************************************
\newcommand{\myTitle}{Live Introspection for Neural Network Training}
\newcommand{\myName}{Rasmus Diederichsen\xspace}
\newcommand{\myFirstSupervisor}{Prof. Dr. Oliver Vornberger\xspace}
\newcommand{\mySecondSupervisor}{Dr. Ulf Krumnack\xspace}
\newcommand{\myProjectSupervisor}{Anders Arpteg, PhD\xspace}
\newcommand{\myUni}{Osnabr√ºck University\xspace}

% ********************************************************************
% Setup, finetuning, and useful commands
% ********************************************************************
\newcounter{dummy} % necessary for correct hyperlinks (to index, bib, etc.)
\newlength{\abcd} % for ab..z string length calculation
\providecommand{\mLyX}{L\kern-.1667em\lower.25em\hbox{Y}\kern-.125emX\@}
% ****************************************************************************************************


% ****************************************************************************************************
% 3. Loading some handy packages
% ****************************************************************************************************
% ********************************************************************
% Packages with options that might require adjustments
% ********************************************************************
\PassOptionsToPackage{utf8}{inputenc}	% latin9 (ISO-8859-9) = latin1+"Euro sign"
\usepackage{inputenc}

%\PassOptionsToPackage{ngerman,american}{babel}   % change this to your language(s)
% Spanish languages need extra options in order to work with this template
%\PassOptionsToPackage{spanish,es-lcroman}{babel}
\usepackage[english]{babel}

\PassOptionsToPackage{authoryear,round,colon}{natbib}
\usepackage{natbib}

\PassOptionsToPackage{fleqn}{amsmath}		% math environments and more by the AMS
\usepackage{amsmath}
\DeclareMathOperator{\Span}{span}

% ********************************************************************
% General useful packages
% ********************************************************************
\PassOptionsToPackage{T1}{fontenc} % T2A for cyrillics
\usepackage{fontenc}
\usepackage{textcomp} % fix warning with missing font shapes
\usepackage{scrhack} % fix warnings when using KOMA with listings package
\usepackage{xspace} % to get the spacing after macros right
\usepackage{mparhack} % get marginpar right
\PassOptionsToPackage{printonlyused,smaller}{acronym}
\usepackage{acronym} % nice macros for handling all acronyms in the thesis
%\renewcommand*{\acsfont}[1]{\textssc{#1}} % for MinionPro
\renewcommand{\bflabel}[1]{{#1}\hfill} % fix the list of acronyms
% ****************************************************************************************************


% ****************************************************************************************************
% 4. Setup floats: tables, (sub)figures, and captions
% ****************************************************************************************************
\usepackage{tabularx} % better tables
\setlength{\extrarowheight}{3pt} % increase table row height
\newcommand{\tableheadline}[1]{\multicolumn{1}{c}{\spacedlowsmallcaps{#1}}}
\newcommand{\myfloatalign}{\centering} % to be used with each float for alignment
\usepackage{caption}
\captionsetup{format=hang,font=small}
% ****************************************************************************************************


% ****************************************************************************************************
% 5. Setup code listings
% ****************************************************************************************************
\usepackage{listings}
%\lstset{emph={trueIndex,root},emphstyle=\color{BlueViolet}}%\underbar} % for special keywords
\lstset{language=Python,
    morekeywords={self,__init__},
    deletekeywords={sum},
    captionpos=b,
    basicstyle=\footnotesize\ttfamily,
    keywordstyle=\color{reddish}\bfseries,
    % identifierstyle=\color{NavyBlue},
    commentstyle=\color{bluegray},
    stringstyle=\color{reddish2},
    numbers=none,%left,%
    numberstyle=\scriptsize,%\tiny
    stepnumber=5,
    numbersep=8pt,
    showstringspaces=false,
    breaklines=true,
    frameround=ffff,
    frame=single,
    rulecolor=\color{black}
}
% ****************************************************************************************************


% ****************************************************************************************************
% 6. PDFLaTeX, hyperreferences and citation backreferences
% ****************************************************************************************************
% ********************************************************************
% Using PDFLaTeX
% ********************************************************************
\PassOptionsToPackage{pdftex, pdfpagelabels}{hyperref}
\usepackage{hyperref}  % backref linktocpage pagebackref
\pdfcompresslevel=9
\pdfadjustspacing=1
\PassOptionsToPackage{pdftex}{graphicx}


% ********************************************************************
% Setup the style of the backrefs from the bibliography
% (translate the options to any language you use)
% ********************************************************************
\newcommand{\backrefnotcitedstring}{\relax}%(Not cited.)
\newcommand{\backrefcitedsinglestring}[1]{(Cited on page~#1.)}
\newcommand{\backrefcitedmultistring}[1]{(Cited on pages~#1.)}
\ifthenelse{\boolean{enable-backrefs}}%
{%
   \PassOptionsToPackage{hyperpageref}{backref}
   \usepackage{backref} % to be loaded after hyperref package
   \renewcommand{\backreftwosep}{ and~} % separate 2 pages
   \renewcommand{\backreflastsep}{, and~} % separate last of longer list
   \renewcommand*{\backref}[1]{}  % disable standard
   \renewcommand*{\backrefalt}[4]{% detailed backref
      \ifcase #1 %
      \backrefnotcitedstring%
      \or%
      \backrefcitedsinglestring{#2}%
      \else%
      \backrefcitedmultistring{#2}%
   \fi}%
}{\relax}

% ********************************************************************
% Hyperreferences
% ********************************************************************
\hypersetup{%
    % draft,	% = no hyperlinking at all (useful in b/w printouts)
    linktocpage=false, pdfstartpage=3, pdfstartview=FitV,%
    % uncomment the following line if you want to have black links (e.g., for printing)
    %colorlinks=false, linktocpage=false, pdfborder={0 0 0}, pdfstartpage=3, pdfstartview=FitV,%
    breaklinks=true, pdfpagemode=UseNone, pageanchor=true, pdfpagemode=UseOutlines,%
    plainpages=false, bookmarksnumbered, bookmarksopen=true, bookmarksopenlevel=1,%
    hypertexnames=true, pdfhighlight=/O,%nesting=true,%frenchlinks,%
    pdftitle={\myTitle},%
    pdfauthor={\textcopyright\ \myName, \myUni},%
    pdfsubject={},%
    pdfkeywords={},%
    pdfcreator={pdfLaTeX},%
    pdfproducer={LaTeX with hyperref and classicthesis}%,
    breaklinks=true,
    hyperfootnotes=true,
    bookmarks=true,
    pdfauthor=\myName,
    pdftitle=\myTitle,
    citecolor=verydarkblue,
    urlcolor=reddish,
    linkcolor=verydarkblue
    colorlinks=false,   % #wtflatex: This doesn't do anything, the only way to
                        % disable colors is to remove them altogether with the drafting option
}

% ********************************************************************
% Setup autoreferences
% ********************************************************************
% There are some issues regarding autorefnames
% http://www.ureader.de/msg/136221647.aspx
% http://www.tex.ac.uk/cgi-bin/texfaq2html?label=latexwords
% you have to redefine the makros for the
% language you use, e.g., american, ngerman
% (as chosen when loading babel/AtBeginDocument)
% ********************************************************************
\makeatletter
\@ifpackageloaded{babel}%
{%
   \addto\extrasamerican{%
      \renewcommand*{\algorithmautorefname}{Algorithm}%
      \renewcommand*{\figureautorefname}{Figure}%
      \renewcommand*{\tableautorefname}{Table}%
      \renewcommand*{\partautorefname}{Part}%
      \renewcommand*{\chapterautorefname}{Chapter}%
      \renewcommand*{\sectionautorefname}{Section}%
      \renewcommand*{\subsectionautorefname}{Subsection}%
      \renewcommand*{\subsubsectionautorefname}{Subsubsection}%
   }%
   \addto\extrasngerman{%
      \renewcommand*{\paragraphautorefname}{Absatz}%
      \renewcommand*{\subparagraphautorefname}{Unterabsatz}%
      \renewcommand*{\footnoteautorefname}{Fu\"snote}%
      \renewcommand*{\FancyVerbLineautorefname}{Zeile}%
      \renewcommand*{\theoremautorefname}{Theorem}%
      \renewcommand*{\appendixautorefname}{Anhang}%
      \renewcommand*{\equationautorefname}{Gleichung}%
   \renewcommand*{\itemautorefname}{Punkt}%
   }%
   % Fix to getting autorefs for subfigures right (thanks to Belinda Vogt for changing the definition)
   \providecommand{\subfigureautorefname}{\figureautorefname}%
}{\relax}
\makeatother


% ****************************************************************************************************
% 7. Last calls before the bar closes
% ****************************************************************************************************
% ********************************************************************
% Development Stuff
% ********************************************************************
\listfiles
%\PassOptionsToPackage{l2tabu,orthodox,abort}{nag}
%	\usepackage{nag}
%\PassOptionsToPackage{warning, all}{onlyamsmath}
%	\usepackage{onlyamsmath}

% ********************************************************************
% Last, but not least...
% ********************************************************************
\usepackage{classicthesis}
% ****************************************************************************************************


% ****************************************************************************************************
% 8. Further adjustments (experimental)
% ****************************************************************************************************
% ********************************************************************
% Changing the text area
% ********************************************************************
%\linespread{1.05} % a bit more for Palatino
%\areaset[current]{312pt}{761pt} % 686 (factor 2.2) + 33 head + 42 head \the\footskip
%\setlength{\marginparwidth}{7em}%
%\setlength{\marginparsep}{2em}%

% ********************************************************************
% Using different fonts
% ********************************************************************
% \usepackage[oldstylenums]{kpfonts} % oldstyle notextcomp
%\usepackage[osf]{libertine}
% \usepackage{hfoldsty} % Computer Modern with osf
%\usepackage[light,condensed,math]{iwona}
%\renewcommand{\sfdefault}{iwona}
%\usepackage{lmodern} % <-- no osf support :-(
%\usepackage[urw-garamond]{mathdesign} %<-- no osf support :-(
% ****************************************************************************************************

%% Should be loaded after classicthesis
\usepackage{ebgaramond}
\usepackage[scale=0.9]{sourcecodepro}

\usepackage[noabbrev, nameinlink]{cleveref}

% https://tex.stackexchange.com/a/63242/31250
\usepackage{xhfill}
\newcommand{\ditto}[1][.4pt]{\xrfill{#1}~\textquotedbl~\xrfill{#1}}
